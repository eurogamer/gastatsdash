{% load humanize %}
<!DOCTYPE html>
<html>
	<head>
    	<meta charset="UTF-8">
	</head>
<body>
	<style>
	body, p{
		font-family: sans-serif;
		text-align: left;
		font-weight: normal;
	}
	thead th{
    	border-bottom: 1px solid #d0d9e0;
	}
	td, th {
		padding: 0.3em 1em 0.3em 0.5em;
		vertical-align: top;
	}
	th.src {
    	font-weight: lighter;
	}
	td.num {
    	text-align: right;
	}
	
	tr.odd {
    	background-color: #f0f2f4;
	}	
	
	tr.even {
    	
	}
    span  {
        display: list-item;
        list-style-type: none;
	}	
	img {
    	margin: 0.2em;
	}

	</style>

    <h2> 
        Where your traffic came from
    </h2>
    <p> 
        Shows the number of visitors referred from a specific source and the type of referral (medium). 
    </p> 
    <table>
        <thead>
            <tr class = 'column_header'>
                <th> Source / Medium </th>
                <th> Visitors </th>
                <th> Page Views </th>
                <th> Percentage of Total Visitors </th>
                <th> Percentage of Total Pageviews </th>
                <th> {{ report_span|get_report_change }} Visitors Change </th>
            </tr>
        </thead>
        <tbody>
            {% for source in traffic_list %}
                <tr class="{% cycle 'odd' 'even' %}">
                    <td class = 'src'> {{source.dimensions.source}} </td>
                    <td class = 'num'> {{source.metrics.visitors|intcomma}} </td>
                    <td class = 'num'> {{source.metrics.pageviews|intcomma}} </td>
                    <td class = 'num'> {{source.metrics.visitors|as_percentage_of:period_totals.first_period.visitors}} </td>
                    <td class = 'num'> {{source.metrics.pageviews|as_percentage_of:period_totals.first_period.pageviews}} </td>
                    <td class = 'num' style="color: {% if source.metrics.change_visitors > 0 %}green{% else %}red{% endif %};"> {{source.metrics.change_visitors|as_percentage_of:source.metrics.visitors}} </td>
                </tr>
            {% endfor %}
        </tbody>
        
    </table>
    
    <h3>
        Top Site Referrals
    </h3>
    <p>
        Top sites with the top articles they've linked to
    </p>
    <table>
        <thead>
            <tr class = 'column_header'>
                <th> Source </th>
                <th> Top Article Linked to </th>
                <th> Page Views </th>
            </tr>
        </thead>
        <tbody>
            {% for key, value in site_referrals.items %}
            <tr class="{% cycle 'odd' 'even' %}">
                <td> {{key}} </td>
                <td class = "src">{% for article in value %}<span><a href="http://{{article.dimensions.host}}{{article.dimensions.path}}">{{article.dimensions.title}}</a></span> {% endfor %}</td>
                <td class="num">{% for article in value %}<span>{{article.metrics.pageviews}}</span> {% endfor %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>


</body>
